## 📌 시스템 구성 개요

본 문서는 **대규모 동시 접속 환경에서도 티켓 예매 서비스(WAS)가 안정적으로 동작하도록 보호**하기 위한

모의 티켓팅 시뮬레이션 시스템의 핵심 구성 요소와 역할을 정리한다.

---

## 1. 브라우저 (Client)

> 본 서비스에 접속한 사용자

- 웹서버(WS)로부터 HTML / CSS / JS 번들을 수신
- 이후 모든 화면은 **CSR(Client-Side Rendering)** 방식으로 렌더링
- API 요청은 직접 WAS 또는 백엔드 서버로 전송

---

## 2. 웹서버 (WS)

> SPA + CSR 구조의 정적 리소스 제공 서버

- 최초 진입 시 HTML / CSS / JS 번들 제공
- 정적 리소스 서빙에 집중하여 서버 부하 최소화
- 런타임 SSR은 지양
- 데모 단계에서는 React 사용
- 향후 확장 시 Next.js의 **SSG / ISR** 도입 가능

---

## 3. 대기열 서버 (Queue Server)

> 티켓 예매 서비스(WAS)로 유입되는 사용자를 제어하는 관문(Gate)

### 역할

- WAS로 진입 가능한 사용자 수를 **정확히 제한**
- 사용자에게 **활성 토큰(Active Token)** 발급
- 대기열 스케줄링 수행

### 내부 큐 구조

- **대기 큐 (Waiting Queue)**
  - 아직 예매가 불가능한 사용자
- **활성 큐 (Active Queue)**
  - 현재 예매를 진행 중인 사용자
  - WAS가 동시에 처리하는 사용자 수와 1:1 대응

> 활성 큐를 별도로 두는 이유는
>
> - "예매 중인 사용자 수를 정확히 제한"하기 위함이다.

### 도입 목적

- 순간적인 대량 트래픽으로 인한 WAS 과부하 방지
- 네트워크 요청 유실 및 타임아웃 문제 예방
- 서버 처리 가능 범위를 초과한 요청을 무질서하게 흘려보내지 않기 위함

---

## 4. 티켓 예매 서비스 (WAS)

> 실제 "예매"와 직접적으로 연관된 요청만 처리하는 핵심 서비스

- 활성 토큰의 유효성 검증
- 좌석 선택, 예매자 정보 입력, 결제 API 처리
- 강한 트랜잭션 정합성 요구

> WAS는 대기열 서버를 통과한 사용자만 접근 가능하도록 설계됨

---

## 5. 일반 백엔드 서버

> 예매와 직접 관련 없는 기능 처리

- 공연 목록 조회
- 채팅, 알림, 기타 일반 API
- 예매 서비스와 분리하여 장애 전파 최소화

---

## 6. Redis Pub/Sub

> 대기열 서버 ↔ 티켓 예매 서비스(WAS) 간 이벤트 전달 수단

- 예매 완료 시 `BOOKING_DONE` 이벤트 발행
- 대기열 서버는 이벤트 수신 후:
  - 활성 큐에서 사용자 제거
  - 다음 대기 사용자를 활성 큐로 이동

> 이를 통해 실제 처리 완료 시점 기준으로
>
> 새로운 사용자를 정확히 수용할 수 있음

---

## 전체 흐름 요약

1. 사용자는 웹서버(WS)에서 정적 리소스를 내려받아 서비스 진입
2. 예매 시도 시 대기열 서버로 요청 이동
3. 대기열 서버에서 순번 대기 → 활성 토큰 발급
4. 활성 토큰을 가진 사용자만 WAS 접근 가능
5. 예매 완료 시 WAS → Redis Pub/Sub → 대기열 서버로 이벤트 전달
6. 대기열 서버가 다음 사용자를 활성화

---

본 구조의 핵심 목표는 다음과 같다:

- **WAS가 절대 터지지 않도록 보호**
- **한정된 자원 내에서 최대 동시 사용자 수용**
- **실제 티켓팅 환경과 유사한 흐름 제공**
